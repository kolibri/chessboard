window.onload=function(){function e(e){if(e&&e.color&&e.type)return e.color+e.type}function t(t,n){for(y in r)for(x in i){var d=i[x]+r[y],a=t.querySelector("."+d),c=n.get(d);a.classList.remove("wk","wq","wr","wb","wn","wp","bk","bq","br","bb","bn","bp"),(pieceClass=e(c))&&a.classList.add(pieceClass)}}function d(e){var t="";return t=0<=e.flags.indexOf("k")?"O-O":0<=e.flags.indexOf("q")?"O-O-O":("p"!=e.piece?e.piece.toUpperCase():"")+e.from+(0<=e.flags.indexOf("c")||0<=e.flags.indexOf("e")?"x":"-")+e.to+(0<=e.flags.indexOf("e")?"ep":"")+(0<=e.flags.indexOf("p")?e.promotion:""),0<=e.san.indexOf("+")&&(t+="+"),0<=e.san.indexOf("#")&&(t+="#"),t}var a=function(e,t,n){for(var d=0;d<e.length;d++)t.call(n,d,e[d])},i=["a","b","c","d","e","f","g","h"],r=[8,7,6,5,4,3,2,1];a(document.querySelectorAll(".pgn"),function(e,a){var c=new Chess;if(c.load_pgn(a.innerHTML.trim())){a.innerHTML="";var o=c.history({verbose:!0}),l=o.length,s=["White","Black","Date","Event","Result"],p=document.createElement("dl");a.appendChild(p),p.classList.add("info");for(filterName in s){var f=document.createElement("dt");f.appendChild(document.createTextNode(s[filterName]));var u=document.createElement("dd"),v=c.header();u.appendChild(document.createTextNode(v[s[filterName]])),p.appendChild(f),p.appendChild(u)}var h=document.createElement("div");h.classList.add("board"),a.appendChild(h);var C="black";for(y in r){var b=document.createElement("div");for(x in i){var E=document.createElement("div"),w=i[x]+r[y];E.classList.add("field"),E.classList.add(w),E.classList.add(C),C="white"==C?"black":"white",b.appendChild(E)}C="white"==C?"black":"white",h.appendChild(b)}t(h,c);var L=document.createElement("ol");L.classList.add("moves");for(m in o){if("w"==o[m].color){var g=document.createElement("li");L.appendChild(g)}var O=document.createElement("span");O.dataset.move=m,O.addEventListener("click",function(){for(c.reset(),n=0;n<=this.dataset.move;n++)c.move(o[n]);l=parseInt(this.dataset.move)+1,t(h,c)}),O.appendChild(document.createTextNode(d(o[m]))),g.appendChild(O)}a.appendChild(L);var k=document.createElement("button");k.appendChild(document.createTextNode("reset")),k.addEventListener("click",function(){c.reset(),t(h,c),l=0}),a.appendChild(k);var N=document.createElement("button");N.appendChild(document.createTextNode("back")),N.addEventListener("click",function(){!l>0||(c.undo(),l-=1,t(h,c))}),a.appendChild(N);var T=document.createElement("button");T.appendChild(document.createTextNode("next")),T.addEventListener("click",function(){if(l<=o.length){for(l+=1,c.reset(),n=1;n<=l;n++)c.move(o[n-1]);t(h,c)}}),a.appendChild(T)}})};