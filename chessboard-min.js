window.onload=function(){var e=function(e,t,a){for(var n=0;n<e.length;n++)t.call(a,n,e[n])},t=function(e){function t(e){for(y in p)for(x in f){var t=f[x]+p[y],a=e.querySelector("."+t),n=u.get(t);a.classList.remove("wk","wq","wr","wb","wn","wp","bk","bq","br","bb","bn","bp"),n&&n.color&&n.type&&a.classList.add(n.color+n.type)}}function a(e){var t="";return t=0<=e.flags.indexOf("k")?"O-O":0<=e.flags.indexOf("q")?"O-O-O":("p"!=e.piece?e.piece.toUpperCase():"")+e.from+(0<=e.flags.indexOf("c")||0<=e.flags.indexOf("e")?"x":"-")+e.to+(0<=e.flags.indexOf("e")?"ep":"")+(0<=e.flags.indexOf("p")?e.promotion:""),0<=e.san.indexOf("+")&&(t+="+"),0<=e.san.indexOf("#")&&(t+="#"),t}function d(){board=document.createElement("div"),board.classList.add("board");var e="white";for(y in p){var t=document.createElement("div");for(x in f){var a=document.createElement("div"),n=f[x]+p[y];a.classList.add("field"),a.classList.add(n),a.classList.add(e),e="white"==e?"black":"white",t.appendChild(a)}e="white"==e?"black":"white",board.appendChild(t)}return board}function r(){var e=u.header();for(filterName in k){var t=k[filterName],a=e[t];v[t]=a}}function s(){var e=document.createElement("dl");e.classList.add("info");for(headerName in v){var t=document.createElement("dt");t.appendChild(document.createTextNode(headerName));var a=document.createElement("dd");a.appendChild(document.createTextNode(v[headerName])),e.appendChild(t),e.appendChild(a)}return e}function i(e){var n=document.createElement("ol");n.classList.add("moves");for(m in N){if("w"==N[m].color){var d=document.createElement("li");n.appendChild(d)}var r=document.createElement("span");r.dataset.move=m,r.addEventListener("click",function(){l(parseInt(this.dataset.move)+1),t(e)}),T-1==r.dataset.move&&r.classList.add("current"),r.appendChild(document.createTextNode(a(N[m]))),d.appendChild(r)}return n}function o(e){function a(e,t){var a=document.createElement("button");a.appendChild(document.createTextNode(e)),a.addEventListener("click",t),n.appendChild(a)}var n=document.createElement("div");return n.classList.add("buttons"),a(L,function(){u.reset(),t(e),T=0}),a(E,function(){!T>0||(u.undo(),T-=1,t(e))}),a(C,function(){l(T+1),t(e)}),a(g,function(){w=!w,p.reverse(),f.reverse(),c()}),n}function l(e){if(!(e>N.length)){for(u.reset(),n=0;n<e;n++)u.move(N[n]);T=e}}function c(){e.innerHTML="",1==b&&e.appendChild(s()),l(T);var a=d();t(a),e.appendChild(a),1==h&&e.appendChild(i(a)),1==h&&e.appendChild(o(a))}var u=new Chess,f=["a","b","c","d","e","f","g","h"],p=[8,7,6,5,4,3,2,1],v={},h=!e.dataset.showMoves||"true"===e.dataset.showMoves,b=!e.dataset.showHeader||"true"===e.dataset.showHeader,w=(!e.dataset.showButtons||"true"===e.dataset.showButtons,!!e.dataset.reversed&&"true"===e.dataset.reversed),C=e.dataset.labelNext?e.dataset.labelNext:"next",E=e.dataset.labelBack?e.dataset.labelBack:"back",L=e.dataset.labelReset?e.dataset.labelReset:"reset",g=e.dataset.labelTurn?e.dataset.labelTurn:"turn",O=!!e.dataset.ply&&parseInt(e.dataset.ply),k=e.dataset.headers?e.dataset.headers.split(","):["White","Black","Date","Event","Result"];if(u.load_pgn(e.innerHTML.trim())){w&&(p.reverse(),f.reverse());var N=u.history({verbose:!0}),T=!1!==O?O:N.length;this.init=function(){r(),c()}}};e(document.querySelectorAll(".pgn"),function(e,a){board=new t(a),board.init()})};