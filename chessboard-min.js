window.onload=function(){function e(e){if(e&&e.color&&e.type)return e.color+e.type}function t(t,n){for(y in r)for(x in o){var a=o[x]+r[y],d=t.querySelector("."+a),i=n.get(a);d.classList.remove("wk","wq","wr","wb","wn","wp","bk","bq","br","bb","bn","bp"),(pieceClass=e(i))&&d.classList.add(pieceClass)}}function a(e){var t="";return t=0<=e.flags.indexOf("k")?"O-O":0<=e.flags.indexOf("q")?"O-O-O":("p"!=e.piece?e.piece.toUpperCase():"")+e.from+(0<=e.flags.indexOf("c")||0<=e.flags.indexOf("e")?"x":"-")+e.to+(0<=e.flags.indexOf("e")?"ep":"")+(0<=e.flags.indexOf("p")?e.promotion:""),0<=e.san.indexOf("+")&&(t+="+"),0<=e.san.indexOf("#")&&(t+="#"),t}function d(e,d){var i=e.history({verbose:!0}),o=document.createElement("ol");o.classList.add("moves");for(m in i){if("w"==i[m].color){var r=document.createElement("li");o.appendChild(r)}var c=document.createElement("span");c.dataset.move=m,c.addEventListener("click",function(){for(e.reset(),n=0;n<=this.dataset.move;n++)e.move(i[n]);currentMoveIndex=parseInt(this.dataset.move)+1,t(board,e)}),c.appendChild(document.createTextNode(a(i[m]))),r.appendChild(c)}d.appendChild(o)}var i=function(e,t,n){for(var a=0;a<e.length;a++)t.call(n,a,e[a])},o=["a","b","c","d","e","f","g","h"],r=[8,7,6,5,4,3,2,1];i(document.querySelectorAll(".pgn"),function(e,a){var i=new Chess;if(i.load_pgn(a.innerHTML.trim())){a.innerHTML="";var c=!a.dataset.moves||a.dataset.moves,l=(!a.dataset.buttons||a.dataset.buttons,i.history({verbose:!0})),s=l.length,p=["White","Black","Date","Event","Result"],m=document.createElement("dl");a.appendChild(m),m.classList.add("info");for(filterName in p){var f=document.createElement("dt");f.appendChild(document.createTextNode(p[filterName]));var u=document.createElement("dd"),v=i.header();u.appendChild(document.createTextNode(v[p[filterName]])),m.appendChild(f),m.appendChild(u)}var h=document.createElement("div");h.classList.add("board"),a.appendChild(h);var b="black";for(y in r){var C=document.createElement("div");for(x in o){var E=document.createElement("div"),w=o[x]+r[y];E.classList.add("field"),E.classList.add(w),E.classList.add(b),b="white"==b?"black":"white",C.appendChild(E)}b="white"==b?"black":"white",h.appendChild(C)}t(h,i),1==c&&d(i,a);var L=document.createElement("button");L.appendChild(document.createTextNode("reset")),L.addEventListener("click",function(){i.reset(),t(h,i),s=0}),a.appendChild(L);var g=document.createElement("button");g.appendChild(document.createTextNode("back")),g.addEventListener("click",function(){!s>0||(i.undo(),s-=1,t(h,i))}),a.appendChild(g);var O=document.createElement("button");O.appendChild(document.createTextNode("next")),O.addEventListener("click",function(){if(s<=l.length){for(s+=1,i.reset(),n=1;n<=s;n++)i.move(l[n-1]);t(h,i)}}),a.appendChild(O)}})};