window.onload=function(){function e(e){if(!e)return"&nbsp";if("w"==e.color)switch(e.type){case"k":return"&#9812";case"q":return"&#9813";case"r":return"&#9814";case"b":return"&#9815";case"n":return"&#9816";case"p":return"&#9817"}else if("b"==e.color)switch(e.type){case"k":return"&#9818";case"q":return"&#9819";case"r":return"&#9820";case"b":return"&#9821";case"n":return"&#9822";case"p":return"&#9823"}return"&nbsp;"}function t(e){if(!e)return null;if("w"==e.color)switch(e.type){case"k":return"wk";case"q":return"wq";case"r":return"wr";case"b":return"wb";case"n":return"wn";case"p":return"wp"}else if("b"==e.color)switch(e.type){case"k":return"bk";case"q":return"bq";case"r":return"br";case"b":return"bb";case"n":return"bn";case"p":return"bp"}return null}function r(n,r){for(y in i)for(x in d){var a=d[x]+i[y],c=n.querySelector("."+a),s=r.get(a);c.classList.remove("wk","wq","wr","wb","wn","wp","bk","bq","br","bb","bn","bp"),c.classList.add(t(s)),c.innerHTML=e(s)}}function a(e){var n="";return n=0<=e.flags.indexOf("k")?"O-O":0<=e.flags.indexOf("q")?"O-O-O":("p"!=e.piece?e.piece.toUpperCase():"")+e.from+(0<=e.flags.indexOf("c")||0<=e.flags.indexOf("e")?"x":"-")+e.to+(0<=e.flags.indexOf("e")?"ep":"")+(0<=e.flags.indexOf("p")?e.promotion:""),0<=e.san.indexOf("+")&&(n+="+"),0<=e.san.indexOf("#")&&(n+="#"),n}var c=function(e,n,t){for(var r=0;r<e.length;r++)n.call(t,r,e[r])},d=["a","b","c","d","e","f","g","h"],i=[8,7,6,5,4,3,2,1];c(document.querySelectorAll(".pgn"),function(e,t){var c=new Chess;if(c.load_pgn(t.innerHTML.trim())){t.innerHTML="";var s=c.history({verbose:!0}),o=s.length,l=["White","Black","Date","Event","Result"],u=document.createElement("dl");t.appendChild(u),u.classList.add("info");for(filterName in l){var p=document.createElement("dt");p.appendChild(document.createTextNode(l[filterName]));var f=document.createElement("dd"),h=c.header();f.appendChild(document.createTextNode(h[l[filterName]])),u.appendChild(p),u.appendChild(f)}var b=document.createElement("div");b.classList.add("board"),t.appendChild(b);var v="black";for(y in i){var w=document.createElement("div");for(x in d){var C=document.createElement("div"),k=d[x]+i[y];C.classList.add("field"),C.classList.add(k),C.classList.add(v),v="white"==v?"black":"white",w.appendChild(C)}v="white"==v?"black":"white",b.appendChild(w)}r(b,c);var E=document.createElement("ol");E.classList.add("moves");for(m in s){if("w"==s[m].color){var L=document.createElement("li");E.appendChild(L)}var g=document.createElement("span");g.dataset.move=m,g.addEventListener("click",function(){for(c.reset(),n=0;n<=this.dataset.move;n++)c.move(s[n]);o=parseInt(this.dataset.move)+1,r(b,c)}),g.appendChild(document.createTextNode(a(s[m]))),L.appendChild(g)}t.appendChild(E);var O=document.createElement("button");O.appendChild(document.createTextNode("reset")),O.addEventListener("click",function(){c.reset(),r(b,c),o=0}),t.appendChild(O);var q=document.createElement("button");q.appendChild(document.createTextNode("back")),q.addEventListener("click",function(){!o>0||(c.undo(),o-=1,r(b,c))}),t.appendChild(q);var N=document.createElement("button");N.appendChild(document.createTextNode("next")),N.addEventListener("click",function(){if(o<=s.length){for(o+=1,c.reset(),n=1;n<=o;n++)c.move(s[n-1]);r(b,c)}}),t.appendChild(N)}})};