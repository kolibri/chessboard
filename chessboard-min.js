window.onload=function(){var e=function(e,t,a){for(var d=0;d<e.length;d++)t.call(a,d,e[d])},t=function(e){function t(){for(y in c)for(x in i){var e=i[x]+c[y],t=board.querySelector("."+e),a=L.get(e);t.classList.remove("wk","wq","wr","wb","wn","wp","bk","bq","br","bb","bn","bp"),a&&a.color&&a.type&&t.classList.add(a.color+a.type)}}function a(e){var t="";return t=0<=e.flags.indexOf("k")?"O-O":0<=e.flags.indexOf("q")?"O-O-O":("p"!=e.piece?e.piece.toUpperCase():"")+e.from+(0<=e.flags.indexOf("c")||0<=e.flags.indexOf("e")?"x":"-")+e.to+(0<=e.flags.indexOf("e")?"ep":"")+(0<=e.flags.indexOf("p")?e.promotion:""),0<=e.san.indexOf("+")&&(t+="+"),0<=e.san.indexOf("#")&&(t+="#"),t}function d(){console.log(h),board=document.createElement("div"),board.classList.add("board"),p.appendChild(board),boardRows=h?c.reverse():c,boardCols=h?i.reverse():i;var e=h?"white":"black";for(y in boardRows){var t=document.createElement("div");for(x in boardCols){var a=document.createElement("div"),d=boardCols[x]+boardRows[y];a.classList.add("field"),a.classList.add(d),a.classList.add(e),e="white"==e?"black":"white",t.appendChild(a)}e="white"==e?"black":"white",board.appendChild(t)}}function o(){var e=document.createElement("dl");p.appendChild(e),e.classList.add("info");var t=L.header();console.log(t,E);for(filterName in E){var a=E[filterName],d=document.createElement("dt");d.appendChild(document.createTextNode(a));var n=document.createElement("dd");n.appendChild(document.createTextNode(t[a])),e.appendChild(d),e.appendChild(n)}}function r(){var e=document.createElement("ol");e.classList.add("moves");for(m in O){if("w"==O[m].color){var d=document.createElement("li");e.appendChild(d)}var n=document.createElement("span");n.dataset.move=m,n.addEventListener("click",function(){l(parseInt(this.dataset.move)+1),t()}),k-1==n.dataset.move&&n.classList.add("current"),n.appendChild(document.createTextNode(a(O[m]))),d.appendChild(n)}p.appendChild(e)}function s(){function e(e,t){var d=document.createElement("button");d.appendChild(document.createTextNode(e)),d.addEventListener("click",t),a.appendChild(d)}var a=document.createElement("div");a.classList.add("buttons"),p.appendChild(a),e(C,function(){L.reset(),t(board,L),k=0}),e(w,function(){!k>0||(L.undo(),k-=1,t(board,L))}),e(v,function(){l(k+1),t(board,L)})}function l(e){if(!(e>O.length)){for(L.reset(),n=0;n<e;n++)L.move(O[n]);k=e}}var i=["a","b","c","d","e","f","g","h"],c=[8,7,6,5,4,3,2,1],p=e,f=!p.dataset.showMoves||"true"===p.dataset.showMoves,u=!p.dataset.showHeader||"true"===p.dataset.showHeader,b=!p.dataset.showButtons||"true"===p.dataset.showButtons,h=!!p.dataset.reversed&&"true"===p.dataset.reversed,v=p.dataset.labelNext?p.dataset.labelNext:"next",w=p.dataset.labelBack?p.dataset.labelBack:"back",C=p.dataset.labelReset?p.dataset.labelReset:"reset",g=!!p.dataset.ply&&parseInt(p.dataset.ply),E=p.dataset.headers?p.dataset.headers.split(","):["White","Black","Date","Event","Result"],L=new Chess;if(L.load_pgn(p.innerHTML.trim())){p.innerHTML="";var O=L.history({verbose:!0}),k=!1!==g?g:O.length;this.render=function(){1==u&&o(),l(k),d(),t(),1==f&&r(),1==b&&s()}}};e(document.querySelectorAll(".pgn"),function(e,a){board=new t(a),board.render()})};